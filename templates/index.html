<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOHA - Love of Human Attraction</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800;900&family=Poppins:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 30px 40px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #ffd93d;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .header-text h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            letter-spacing: 0.5px;
        }

        .header-text .tagline {
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            font-weight: 400;
            opacity: 0.95;
            letter-spacing: 0.3px;
        }

        .header-buttons {
            display: flex;
            gap: 15px;
        }

        .header-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .header-btn.primary {
            background: #ffd93d;
            color: #1a1a2e;
        }

        .header-btn.secondary {
            background: rgba(255,255,255,0.2);
            color: #fff;
            border: 2px solid #fff;
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 217, 61, 0.4);
        }

        /* Hero Section */
        .hero-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .hero-image {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            height: 400px;
        }

        .hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .hero-image:hover img {
            transform: scale(1.05);
        }

        .hero-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px;
        }

        .hero-content h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #f39c12 0%, #ffd93d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-content p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        /* Feature Cards */
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .feature-card {
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.2);
        }

        .feature-card .icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .feature-card h3 {
            color: #f39c12;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .feature-card p {
            opacity: 0.9;
            line-height: 1.6;
        }

        /* Archetypes Section */
        .archetypes-section {
            background: rgba(255,255,255,0.03);
            padding: 40px;
            border-radius: 20px;
            margin: 40px 0;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .archetypes-section h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f39c12 0%, #ffd93d 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .archetypes-section .subtitle {
            text-align: center;
            margin-bottom: 30px;
            opacity: 0.8;
        }

        .archetypes-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .archetype-token {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
        }

        .archetype-token:hover {
            transform: scale(1.05);
            background: rgba(255,255,255,0.1);
            border-color: #f39c12;
        }

        .archetype-token .token-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .archetype-token h4 {
            color: #ffd93d;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .archetype-token p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .archetypes-info {
            background: rgba(255,107,157,0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border-left: 4px solid #f39c12;
        }

        .archetypes-info h3 {
            color: #f39c12;
            margin-bottom: 10px;
        }

        .archetypes-info p {
            opacity: 0.9;
            line-height: 1.6;
        }

        /* Form Section */
        .form-section {
            background: rgba(255,255,255,0.05);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 40px;
        }

        .form-section h2 {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #f39c12;
            text-align: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #f39c12;
            font-size: 0.95rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #f39c12;
            background: rgba(255,255,255,0.1);
        }

        /* Fix dropdown text color */
        select {
            color: #000;
            background: #fff;
        }

        select option {
            color: #000;
            background: #fff;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .relationship-entry {
            background: rgba(255,255,255,0.03);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .relationship-entry h3 {
            color: #f39c12;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        button.submit-btn {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: #fff;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
            display: block;
            margin: 30px auto;
        }

        button.submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.5);
        }

        /* Chat Section */
        .chat-section {
            display: none;
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 107, 157, 0.3);
        }

        .chat-header h2 {
            color: #f39c12;
            font-size: 1.8rem;
        }

        .chat-container {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            text-align: right;
        }

        .message.assistant {
            text-align: left;
        }

        .message-content {
            display: inline-block;
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            border-bottom-right-radius: 5px;
        }

        .message.assistant .message-content {
            background: rgba(255,255,255,0.1);
            border-bottom-left-radius: 5px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            margin-bottom: 0;
        }

        .chat-input button {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            margin: 0;
            padding: 12px 30px;
            font-size: 1rem;
            border: none;
            border-radius: 25px;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
        }

        /* Testimonial */
        .testimonial {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.3);
        }

        .testimonial p {
            font-size: 1.3rem;
            font-style: italic;
            margin-bottom: 20px;
        }

        .testimonial cite {
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        footer .copyright {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        footer .privacy-notice {
            font-size: 0.8rem;
            opacity: 0.8;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            max-width: 800px;
            margin: 20px auto;
            line-height: 1.5;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
                padding: 20px;
            }

            .header-left {
                flex-direction: column;
                gap: 15px;
            }

            .logo {
                width: 100px;
                height: 100px;
            }

            .header-text h1 {
                font-size: 2rem;
            }

            .header-buttons {
                flex-direction: column;
                width: 100%;
                gap: 10px;
            }

            .header-btn {
                width: 100%;
            }

            .hero-section {
                grid-template-columns: 1fr;
            }

            .hero-image {
                height: 300px;
            }

            .archetypes-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .message-content {
                max-width: 85%;
            }
        }

        /* Typing Indicator */
        .typing-indicator {
            display: inline-block;
            padding: 15px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            border-bottom-left-radius: 5px;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #f39c12;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* Paywall Styles */
        .paywall-container {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
        }

        .paywall-container h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #fff;
        }

        .paywall-container p {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #fff;
        }

        .paywall-btn {
            background: #fff;
            color: #f39c12;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .paywall-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <img src="https://images.unsplash.com/photo-1516589178581-6cd7833ae3b2?w=200&h=200&fit=crop&crop=face" alt="LOHA Logo" class="logo">
                <div class="header-text">
                    <h1>Loha Dating Coach</h1>
                    <p class="tagline">Personalised Advice for Dating and Relationships</p>
                </div>
            </div>
            <div class="header-buttons">
                <a href="https://www.loha.dating" class="header-btn primary">Visit LOHA</a>
                <a href="https://loha.dating/user/sign-up" class="header-btn secondary">Sign Up Free</a>
            </div>
        </header>

        <div class="hero-section">
            <div class="hero-image">
                <img src="https://images.unsplash.com/photo-1543269865-cbf427effbad?w=800&h=600&fit=crop" alt="Romantic couple">
            </div>
            <div class="hero-content">
                <h2>Discover Your Dating Archetype</h2>
                <h2 style="font-size: 1.8rem;">Transform Your Love Life</h2>
                <p>Using advanced AI pattern recognition called Deepsyke, we analyze your unique dating personality to reveal your archetype, relationship signatures, and the exact strategies that will help you attract your ideal match‚Äîwhether that's a soulmate, a passionate connection, or something perfectly in between.</p>
                <p>Get personalized insights that go deeper than any dating advice you've tried before. Understand what makes you magnetic, and learn how to create the connections you actually want.</p>
            </div>
        </div>

        <div class="features">
            <div class="feature-card">
                <div class="icon">üß†</div>
                <h3>Deepsyke AI Analysis</h3>
                <p>Advanced pattern recognition that reveals your dating personality, relationship signatures, and attraction patterns‚Äîgiving you insights no human coach could match.</p>
            </div>
            <div class="feature-card">
                <div class="icon">üíé</div>
                <h3>8 Unique Archetypes</h3>
                <p>From Mystic to King, each archetype has distinct characteristics, strengths, and dating superpowers.</p>
            </div>
            <div class="feature-card">
                <div class="icon">üó£Ô∏è</div>
                <h3>Personalized Coaching</h3>
                <p>Get tailored advice that speaks directly to your archetype - no generic one-size-fits-all nonsense.</p>
            </div>
        </div>

        <div class="archetypes-section">
            <h2>‚ú® The 8 Dating Archetypes</h2>
            <p class="subtitle">Discover which archetype resonates with you</p>
            
            <div class="archetypes-grid">
                <div class="archetype-token">
                    <div class="token-icon">üîÆ</div>
                    <h4>Mystic</h4>
                    <p>Deep, soulful, intuitive</p>
                </div>
                <div class="archetype-token">
                    <div class="token-icon">üå∏</div>
                    <h4>Maiden</h4>
                    <p>Free-spirited, authentic, warm</p>
                </div>
                <div class="archetype-token">
                    <div class="token-icon">üëë</div>
                    <h4>Queen</h4>
                    <p>Sophisticated, discerning, refined</p>
                </div>
                <div class="archetype-token">
                    <div class="token-icon">üèπ</div>
                    <h4>Huntress</h4>
                    <p>Confident, ambitious, independent</p>
                </div>
                <div class="archetype-token">
                    <div class="token-icon">‚ú®</div>
                    <h4>Magician</h4>
                    <p>Intuitive, creative, insightful</p>
                </div>
                <div class="archetype-token">
                    <div class="token-icon">‚öîÔ∏è</div>
                    <h4>Knight</h4>
                    <p>Chivalrous, protective, romantic</p>
                </div>
                <div class="archetype-token">
                    <div class="token-icon">üõ°Ô∏è</div>
                    <h4>Warrior</h4>
                    <p>Confident, bold, accomplished</p>
                </div>
                <div class="archetype-token">
                    <div class="token-icon">ü¶Å</div>
                    <h4>King</h4>
                    <p>Natural leader, decisive, visionary</p>
                </div>
            </div>

            <div class="archetypes-info">
                <h3>Why Archetypes Matter</h3>
                <p>Our archetype system uses Deepsyke AI to analyze your dating patterns and energy expression, helping you communicate better, attract the right matches, and create deeper, more meaningful connections.</p>
            </div>
        </div>

        <div id="profileForm" class="form-section">
            <h2>‚ú® Let's Discover Your Dating Archetype</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="name" placeholder="Enter your name" required>
                </div>
                
                <div class="form-group">
                    <label>Date of Birth</label>
                    <input type="date" id="dob" required>
                </div>
                
                <div class="form-group">
                    <label>Gender</label>
                    <select id="gender" required>
                        <option value="">Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>üéì What are your dating and relationship goals?</label>
                <textarea id="goals" placeholder="Tell me what you're looking for - casual dating, serious relationship, marriage, or just having fun figuring it out..."></textarea>
            </div>

            <div class="form-group">
                <label>ü§î What are your biggest dating challenges or issues?</label>
                <textarea id="challenges" placeholder="First date nerves? Bad text game? Attracting the wrong type? Can't get past the talking stage? Lay it all out..."></textarea>
            </div>

            <div class="form-group">
                <label>üí™ What areas do you want to improve?</label>
                <textarea id="improvements" placeholder="Confidence? Conversation skills? Physical chemistry? Online dating profile? Be honest with yourself..."></textarea>
            </div>

            <div class="relationship-entry">
                <h3>üí• Important People in Your Life (Optional)</h3>
                <p style="margin-bottom: 15px; opacity: 0.8;">Add up to 4 people to understand relationship dynamics</p>
                
                <div id="relationships">
                    <!-- Person 1 -->
                    <div class="form-grid" style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label>Person 1 - Name</label>
                            <input type="text" class="rel-name" placeholder="Name">
                        </div>
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" class="rel-dob">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select class="rel-gender">
                                <option value="">Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Relationship to You</label>
                            <input type="text" class="rel-type" placeholder="Ex: ex, lover, friend, crush...">
                        </div>
                    </div>

                    <!-- Person 2 -->
                    <div class="form-grid" style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label>Person 2 - Name</label>
                            <input type="text" class="rel-name" placeholder="Name">
                        </div>
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" class="rel-dob">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select class="rel-gender">
                                <option value="">Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Relationship to You</label>
                            <input type="text" class="rel-type" placeholder="Ex: ex, lover, friend, crush...">
                        </div>
                    </div>

                    <!-- Person 3 -->
                    <div class="form-grid" style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label>Person 3 - Name</label>
                            <input type="text" class="rel-name" placeholder="Name">
                        </div>
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" class="rel-dob">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select class="rel-gender">
                                <option value="">Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Relationship to You</label>
                            <input type="text" class="rel-type" placeholder="Ex: ex, lover, friend, crush...">
                        </div>
                    </div>

                    <!-- Person 4 -->
                    <div class="form-grid" style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label>Person 4 - Name</label>
                            <input type="text" class="rel-name" placeholder="Name">
                        </div>
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" class="rel-dob">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select class="rel-gender">
                                <option value="">Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Relationship to You</label>
                            <input type="text" class="rel-type" placeholder="Ex: ex, lover, friend, crush...">
                        </div>
                    </div>
                </div>
            </div>

            <button class="submit-btn" onclick="submitProfile()">‚ú® Discover My Archetype</button>
        </div>

        <div id="chatSection" class="chat-section">
            <div class="chat-header">
                <h2>üó£Ô∏è Let's Talk Dating</h2>
                <button class="header-btn secondary" onclick="resetChat()" style="margin: 0; padding: 10px 20px; font-size: 0.9rem;">New Chat</button>
            </div>
            <div id="chatContainer" class="chat-container">
                <!-- Messages will appear here -->
            </div>
            <div class="chat-input">
                <input type="text" id="messageInput" placeholder="Ask me anything about dating..." onkeypress="if(event.key === 'Enter') sendMessage()">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>

        <div class="testimonial">
            <p>"Finally, a dating coach who gets it! LOHA helped me understand my archetype and suddenly everything clicked. I'm attracting the right people and having way more fun."</p>
            <cite>- Sarah, The Queen</cite>
        </div>

        <footer>
            <div class="copyright">
                <p>Loha Dating Coach and Deepsyke AI. Copyright. 2026. All rights reserved.</p>
                <p>Affinity Zones, Deepsyke AI modelling is exclusively licensed and protected IP.</p>
            </div>
            <div class="privacy-notice">
                <strong>Privacy & Disclaimer:</strong><br>
                This is not a medical or professional diagnosis but a self-help tool used at the discretion of the user and we take no responsibility for the actions taken as a result of engaging with Deepsyke integrations. No personal data is stored or captured and is only valid for a single session or until user closes browser.
            </div>
        </footer>
    </div>

    <script>
        let sessionId = '';
        let userName = '';
        let messageCount = 0;
        let isPaid = false;

        // Check for payment success on page load
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const checkoutSessionId = urlParams.get('session_id');
            const lohaSessionId = urlParams.get('loha_session');
            
            if (checkoutSessionId && lohaSessionId) {
                // Payment was successful, restore session
                sessionId = lohaSessionId;
                checkPaymentStatus();
            }
        });

        function checkPaymentStatus() {
            fetch('/api/check-payment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    session_id: sessionId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.paid) {
                    isPaid = true;
                    // Hide form, show chat
                    document.getElementById('profileForm').style.display = 'none';
                    document.getElementById('chatSection').style.display = 'block';
                    // Clear URL parameters
                    window.history.replaceState({}, document.title, window.location.pathname);
                    // Restore conversation history
                    if (data.history && data.history.length > 0) {
                        const container = document.getElementById('chatContainer');
                        container.innerHTML = '';
                        data.history.forEach(msg => {
                            const role = msg.role === 'user' ? 'user' : 'assistant';
                            displayMessage(role, msg.content);
                        });
                    }
                    // Show welcome back message
                    displayMessage('assistant', 'Welcome back! Your payment was successful. Let\'s continue our conversation!');
                }
            })
            .catch(error => {
                console.error('Error checking payment:', error);
            });
        }

        function handlePaywall() {
            // Create checkout session
            fetch('/api/create-checkout-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    session_id: sessionId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Redirect to Stripe checkout
                    window.location.href = data.checkout_url;
                } else {
                    alert('Error creating checkout session. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Something went wrong. Please try again.');
            });
        }

        function submitProfile() {
            const name = document.getElementById('name').value;
            const dob = document.getElementById('dob').value;
            const gender = document.getElementById('gender').value;
            const goals = document.getElementById('goals').value;
            const challenges = document.getElementById('challenges').value;
            const improvements = document.getElementById('improvements').value;

            if (!name || !dob || !gender) {
                alert('Please fill in your name, date of birth, and gender!');
                return;
            }

            // Generate session ID
            sessionId = Date.now().toString();
            userName = name;

            // Collect relationships
            const relationships = [];
            const relNames = document.querySelectorAll('.rel-name');
            const relDobs = document.querySelectorAll('.rel-dob');
            const relGenders = document.querySelectorAll('.rel-gender');
            const relTypes = document.querySelectorAll('.rel-type');

            for (let i = 0; i < relNames.length; i++) {
                if (relNames[i].value && relDobs[i].value) {
                    relationships.push({
                        name: relNames[i].value,
                        dob: relDobs[i].value,
                        gender: relGenders[i].value,
                        type: relTypes[i].value
                    });
                }
            }

            // Send to backend
            fetch('/api/initialize', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    session_id: sessionId,
                    name: name,
                    dob: dob,
                    gender: gender,
                    goals: goals,
                    challenges: challenges,
                    improvements: improvements,
                    relationships: relationships
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('profileForm').style.display = 'none';
                    document.getElementById('chatSection').style.display = 'block';
                    displayMessage('assistant', data.message);
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Something went wrong. Please try again.');
            });
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message) return;

            // Display user message
            displayMessage('user', message);
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Send to backend
            fetch('/api/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    session_id: sessionId,
                    message: message
                })
            })
            .then(response => response.json())
            .then(data => {
                hideTypingIndicator();
                
                // Check if paywall triggered
                if (data.paywall) {
                    displayMessage('assistant', data.message);
                    
                    // Show paywall button
                    const container = document.getElementById('chatContainer');
                    const paywallDiv = document.createElement('div');
                    paywallDiv.className = 'message assistant';
                    paywallDiv.innerHTML = `
                        <div class="paywall-container">
                            <h3>üîì Unlock Unlimited Access</h3>
                            <p>Continue your personalized dating coaching journey for just <strong>$2.95</strong></p>
                            <button onclick="handlePaywall()" class="paywall-btn">Unlock Now - $2.95</button>
                        </div>
                    `;
                    container.appendChild(paywallDiv);
                    container.scrollTop = container.scrollHeight;
                    
                    // Disable input
                    document.getElementById('messageInput').disabled = true;
                    return;
                }
                
                if (data.success) {
                    displayMessage('assistant', data.message);
                    messageCount = data.message_count || messageCount + 1;
                    isPaid = data.paid || isPaid;
                } else {
                    displayMessage('assistant', 'Sorry, something went wrong. Please try again.');
                }
            })
            .catch(error => {
                hideTypingIndicator();
                console.error('Error:', error);
                displayMessage('assistant', 'Sorry, something went wrong. Please try again.');
            });
        }

        function displayMessage(type, content) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `<div class="message-content">${content.replace(/\n/g, '<br>')}</div>`;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            const container = document.getElementById('chatContainer');
            const indicator = document.createElement('div');
            indicator.id = 'typingIndicator';
            indicator.className = 'message assistant';
            indicator.innerHTML = `
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            container.appendChild(indicator);
            container.scrollTop = container.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function resetChat() {
            const container = document.getElementById('chatContainer');
            container.innerHTML = '';
        }
    </script>
</body>
</html>
